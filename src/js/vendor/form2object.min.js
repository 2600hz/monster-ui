/**
 * Copyright (c) 2010 Maxim Vasiliev
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * @author Maxim Vasiliev
 * Date: 09.09.2010
 * Time: 19:02:33
 */
!function(){function e(e,r){var a=t(e,r);return a.length>0?a:n(e,r)}function n(e,n){for(var r=[],a=e.firstChild;a;)r=r.concat(t(a,n)),a=a.nextSibling;return r}function t(e,t){var a,u,i=[];return(a=t&&t(e))&&a.name?i=[a]:e.nodeName.match(/INPUT|TEXTAREA/i)?null!==(u=r(e))&&(i=[{name:e.name,value:u}]):e.nodeName.match(/SELECT/i)?null!==(u=r(e))&&(i=[{name:e.name,value:u}]):i=n(e,t),i}function r(e){switch(e.nodeName){case"INPUT":case"TEXTAREA":switch(e.type.toLowerCase()){case"radio":if(e.checked)return e.value;break;case"checkbox":if("true"===e.value||"on"===e.value)return e.checked;if(e.checked)return e.value;break;case"button":case"reset":case"submit":case"image":return"";default:return e.value}break;case"SELECT":return function(e){var n,t=e.multiple,r=[];if(!t)return e.value;for(n=e.getElementsByTagName("option"),i=0,l=n.length;i<l;i++)n[i].selected&&r.push(n[i].value);return r}(e)}return null}window.form2object=function(n,t,r,a){void 0!==r&&null!=r||(r=!1),void 0!==t&&null!=t||(t=".");var u,i=[],l=0;if((n="string"==typeof n?document.getElementById(n):n).constructor==Array||"undefined"!=typeof NodeList&&n.constructor==NodeList)for(;u=n[l++];)i=i.concat(e(u,a));else i=e(n,a);return function(e,n,t){var r,a,u,i,l,o,c,s,f,h,d,g,m,v={},p={};for(r=0;r<e.length;r++)if(l=e[r].value,!n||""!==l){for(g=e[r].name,m=g.split(t),o=[],c=v,s="",a=0;a<m.length;a++)if((d=m[a].split("][")).length>1)for(u=0;u<d.length;u++)if(0==u?d[u]=d[u]+"]":u==d.length-1?d[u]="["+d[u]:d[u]="["+d[u]+"]",h=d[u].match(/([a-z_]+)?\[([a-z_][a-z0-9]+?)\]/i))for(i=1;i<h.length;i++)h[i]&&o.push(h[i]);else o.push(d[u]);else o=o.concat(d);for(a=0;a<o.length;a++)(d=o[a]).indexOf("[]")>-1&&a==o.length-1?(f=d.substr(0,d.indexOf("[")),s+=f,c[f]||(c[f]=[]),c[f].push(l)):d.indexOf("[")>-1?(f=d.substr(0,d.indexOf("[")),h=d.replace(/(^([a-z_]+)?\[)|(\]$)/gi,""),p[s+="_"+f+"_"+h]||(p[s]={}),""==f||c[f]||(c[f]=[]),a==o.length-1?""==f?(c.push(l),p[s][h]=c[c.length-1]):(c[f].push(l),p[s][h]=c[f][c[f].length-1]):p[s][h]||(/^[a-z_]+\[?/i.test(o[a+1])?c[f].push({}):c[f].push([]),p[s][h]=c[f][c[f].length-1]),c=p[s][h]):(s+=d,a<o.length-1?(c[d]||(c[d]={}),c=c[d]):c[d]=l)}return v}(i,r,t)},window.form2json=window.form2object}();
